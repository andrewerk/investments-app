on: [push, pull_request]

jobs:
  eslint:
    runs-on: ubuntu-latest
    steps:
        - name: Verify Git repository
          uses: actions/checkout@v2

        - name: Install node
          uses: actions/setup-node@v1
          with:
            node-version: 16


        - name: install dependencies
          run: npm install

        - name: executes eslint
          run: npx eslint .
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js 16.x
        uses: actions/setup-node@v1
        with:
          node-version: 16.x

      - name: Install dependencies
        run: npm install

      - name: run docker-compose
        run: docker-compose up --build -d

      - name: Enter docker bash
        run: docker exec -it stock-app /bin/sh

      - name: run tests
        run: npm test
        env:
          DB_HOST: db
          DB_PASSWORD: password
          DB_USERNAME: root
          DB_NAME: StockApp
          DB_DIALECT: postgres
          JWT_SECRET: MySecretToken